---
import { getCollection } from 'astro:content';
import Base from './Base.astro';
import Nav from '@components/Nav.astro';

interface Props {
  title: string;
  description: string;
  date: Date;
  slug: string;
}

const { title, description, date, slug } = Astro.props;

const formattedDate = date.toLocaleDateString('en-AU', {
  day: 'numeric',
  month: 'long',
  year: 'numeric',
});

const allArticles = await getCollection('articles');
const moreArticles = allArticles
  .filter((a) => a.slug !== slug)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<Base title={`${title} — Antonio Almeida`} description={description} ogType="article">
  <div class="accent accent--top" aria-hidden="true"></div>

  <div class="page">
    <Nav />

    <main>
      <article>

        <!-- Hero -->
        <div class="hero">
          <a href="/" class="name-link">Antonio Almeida</a>
          <h1>{title}</h1>
          <p class="date">{formattedDate}</p>
        </div>

        <!-- Markdown content -->
        <div class="content">
          <slot />
        </div>

        <!-- More Writing -->
        {moreArticles.length > 0 && (
          <div class="more-writing">
            <hr />
            <h2>More Writing</h2>
            <ul>
              {moreArticles.map((a) => (
                <li>
                  <a href={`/articles/${a.slug}`}>
                    {a.data.category && (
                      <span class="more-category">{a.data.category}—</span>
                    )}
                    <span class="more-title">{a.data.title}</span>
                  </a>
                </li>
              ))}
            </ul>
          </div>
        )}

        <!-- Footer -->
        <footer>
          <hr />
          <a href="/" class="home-link">Home →</a>
          <p>Antonio Almeida &copy; 2026</p>
        </footer>

      </article>
    </main>
  </div>

  <div class="accent accent--bottom" aria-hidden="true"></div>
</Base>

<style>
  .accent {
    position: fixed;
    left: 0;
    width: 100%;
    height: 2px;
    background: var(--color-accent);
    z-index: 100;
  }
  .accent--top { top: 0; }
  .accent--bottom { bottom: 0; }

  .page {
    position: relative;
    max-width: var(--layout-width);
    margin: 0 auto;
    padding: var(--section-gap) 0;
  }

  /* ── Hero ─────────────────────────────────────── */
  .hero {
    display: flex;
    flex-direction: column;
    gap: var(--section-gap);
  }

  .name-link {
    font-family: var(--font-sans);
    font-weight: var(--weight-medium);
    font-size: 20px;
    line-height: 1.8;
    text-decoration: none;
    color: var(--color-fg);
  }

  .name-link:hover {
    text-decoration: underline;
  }

  h1 {
    font-family: var(--font-sans);
    font-weight: var(--weight-medium);
    font-size: 44px;
    line-height: 1.3;
    color: var(--color-fg);
    max-width: var(--content-width);
  }

  .date {
    font-family: var(--font-sans);
    font-weight: var(--weight-regular);
    font-size: 20px;
    line-height: 1.1;
    color: var(--color-fg);
  }

  /* ── Content (Markdown) ───────────────────────── */
  .content {
    display: flex;
    flex-direction: column;
    margin-top: var(--section-gap);
    border-top: 1px solid var(--color-divider);
    padding-top: var(--section-gap);
  }

  .content :global(p) {
    font-family: var(--font-serif);
    font-weight: var(--weight-regular);
    font-size: 20px;
    line-height: 1.8;
    color: var(--color-fg);
    max-width: var(--content-width);
    margin-bottom: var(--row-gap);
  }

  .content :global(p:last-child) {
    margin-bottom: 0;
  }

  /* Pull quotes — use > blockquote in Markdown */
  .content :global(blockquote) {
    margin: var(--section-gap) 0;
    padding: 0;
    border: none;
    font-family: var(--font-sans);
    font-weight: var(--weight-medium);
    font-size: 28px;
    line-height: 1.1;
    color: var(--color-fg);
    max-width: var(--content-width);
  }

  .content :global(blockquote p) {
    font-family: var(--font-sans);
    font-weight: var(--weight-medium);
    font-size: 28px;
    line-height: 1.1;
    max-width: var(--content-width);
    margin-bottom: 0;
  }

  /* Dividers between sections — use --- in Markdown */
  .content :global(hr) {
    border: none;
    border-top: 1px solid var(--color-divider);
    margin: var(--section-gap) 0;
  }

  /* Full-width images */
  .content :global(p:has(> img)) {
    max-width: 100%;
    margin-bottom: 0;
  }

  .content :global(img),
  .content :global(video) {
    display: block;
    width: 100%;
    height: auto;
  }

  .content :global(a) {
    color: var(--color-fg);
    text-decoration: underline;
  }

  /* ── More Writing ─────────────────────────────── */
  .more-writing {
    display: flex;
    flex-direction: column;
    gap: var(--section-gap);
  }

  hr {
    border: none;
    border-top: 1px solid var(--color-divider);
    margin: 0;
  }

  h2 {
    font-family: var(--font-sans);
    font-weight: var(--weight-medium);
    font-size: 28px;
    line-height: normal;
    color: var(--color-fg);
  }

  .more-writing ul {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--row-gap);
    max-width: var(--content-width);
  }

  .more-writing li {
    position: relative;
  }

  .more-writing li::before {
    content: '';
    position: absolute;
    inset-block: -8px;
    left: calc((var(--layout-width) - 100vw) / 2);
    width: 100vw;
    background: var(--color-hover-bg);
    z-index: -1;
    opacity: 0;
    transition: opacity 0.1s ease;
  }

  .more-writing li:hover::before {
    opacity: 1;
  }

  .more-writing a {
    font-family: var(--font-sans);
    font-size: 20px;
    line-height: 1.8;
    text-decoration: none;
    color: var(--color-fg);
  }

  .more-category {
    font-weight: var(--weight-medium);
  }

  .more-title {
    font-weight: var(--weight-regular);
  }

  /* ── Footer ───────────────────────────────────── */
  footer {
    display: flex;
    flex-direction: column;
    gap: var(--section-gap);
    align-items: flex-start;
    margin-top: var(--section-gap);
  }

  .home-link {
    display: inline;
    font-family: var(--font-serif);
    font-weight: var(--weight-regular);
    font-size: 20px;
    line-height: 1.8;
    color: var(--color-accent);
    text-decoration: none;
    border-bottom: 1px solid var(--color-accent);
  }

  footer p {
    font-family: var(--font-sans);
    font-weight: var(--weight-regular);
    font-size: 20px;
    line-height: 1.8;
    color: var(--color-fg);
  }
</style>
